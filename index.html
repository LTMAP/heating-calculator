<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор теплого пола</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .input-section, .output-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .input-section {
            flex: 1;
            min-width: 300px;
        }
        .output-section {
            flex: 2;
            min-width: 500px;
        }
        h1, h2 {
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .room {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            position: relative;
        }
        .remove-room {
            background-color: #f44336;
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
        }
        .remove-room:hover {
            background-color: #d32f2f;
        }
        .result-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .section-info {
            background-color: #f9f9f9;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .layout {
            margin-top: 15px;
            border: 1px solid #ddd;
            padding: 10px;
            position: relative;
            height: 300px;
            overflow: auto;
        }
        .room-outline {
            border: 2px solid #333;
            position: relative;
            margin: 20px auto;
            background-color: #f0f0f0;
        }
        .section {
            position: absolute;
            border: 1px solid #999;
            background-color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            overflow: hidden;
        }
        .section-label {
            transform: rotate(-45deg);
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Калькулятор теплого пола</h1>
    
    <div class="container">
        <div class="input-section">
            <div class="form-group">
                <label for="insulation">Степень утепления:</label>
                <select id="insulation">
                    <option value="high">Высокое</option>
                    <option value="medium" selected>Среднее</option>
                    <option value="low">Низкое</option>
                </select>
            </div>
            
            <h2>Помещения</h2>
            <div id="rooms-container">
                <div class="room">
                    <div class="form-group">
                        <label>Название помещения:</label>
                        <input type="text" class="room-name" placeholder="Например, Гостиная">
                    </div>
                    <div class="form-group">
                        <label>Длина (м):</label>
                        <input type="number" class="room-length" min="0.1" step="0.1" value="5">
                    </div>
                    <div class="form-group">
                        <label>Ширина (м):</label>
                        <input type="number" class="room-width" min="0.1" step="0.1" value="4">
                    </div>
                    <button class="remove-room">Удалить</button>
                </div>
            </div>
            
            <button id="add-room">Добавить помещение</button>
            <button id="calculate">Рассчитать</button>
        </div>
        
        <div class="output-section">
            <h2>Результаты расчета</h2>
            <div id="results"></div>
        </div>
    </div>

    <script>
        const models = [
            {name: 'ТКС-01', power: 230, powerM2: 460, area: 0.5, width: 1, length: 0.5},
            {name: 'ТКС-02', power: 180, powerM2: 360, area: 0.5, width: 1, length: 0.5},
            {name: 'ТКС-03', power: 180, powerM2: 250, area: 0.72, width: 1, length: 0.72},
            {name: 'ТКС-04', power: 160, powerM2: 213, area: 0.75, width: 1, length: 0.75},
            {name: 'ТКС-05', power: 140, powerM2: 165, area: 0.85, width: 1, length: 0.85},
            {name: 'ТКС-06', power: 140, powerM2: 140, area: 1, width: 1, length: 1},
            {name: 'ТКС-07', power: 100, powerM2: 71, area: 1.4, width: 1, length: 1.4},
            {name: 'ТКС-08', power: 180, powerM2: 257, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-09', power: 150, powerM2: 214, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-10', power: 150, powerM2: 185, area: 0.81, width: 0.7, length: 1.15},
            {name: 'ТКС-11', power: 145, powerM2: 188, area: 0.77, width: 0.7, length: 1.1},
            {name: 'ТКС-12', power: 140, powerM2: 200, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-13', power: 140, powerM2: 154, area: 0.91, width: 0.7, length: 1.3},
            {name: 'ТКС-14', power: 120, powerM2: 143, area: 0.84, width: 0.7, length: 1.2}
        ];

        // Фильтрация моделей по степени утепления
        function filterModels(insulation) {
            switch(insulation) {
                case 'low':
                    return models.filter(model => model.powerM2 >= 200);
                case 'medium':
                    return models.filter(model => model.powerM2 >= 180 && model.powerM2 < 200);
                case 'high':
                    return models.filter(model => model.powerM2 >= 140 && model.powerM2 < 180);
                default:
                    return models;
            }
        }

        // Расчет оптимальной секции для помещения
        function calculateOptimalSection(roomLength, roomWidth, availableModels) {
            const roomArea = roomLength * roomWidth;
            const minRequiredPower = roomArea * 140; // Минимальная требуемая мощность
            
            // Фильтруем модели, которые могут покрыть минимальную мощность
            const suitableModels = availableModels.filter(model => {
                const sectionsNeeded = Math.ceil(roomArea / model.area);
                return sectionsNeeded * model.power >= minRequiredPower;
            });
            
            if (suitableModels.length === 0) return null;
            
            // Выбираем модель с наименьшим количеством секций
            return suitableModels.reduce((best, current) => {
                const bestSections = Math.ceil(roomArea / best.area);
                const currentSections = Math.ceil(roomArea / current.area);
                
                if (currentSections < bestSections) return current;
                if (currentSections === bestSections && current.power > best.power) return current;
                return best;
            });
        }

        // Создание схемы укладки
        function createLayout(roomLength, roomWidth, section, scale = 20) {
            const layoutDiv = document.createElement('div');
            layoutDiv.className = 'layout';
            
            const roomOutline = document.createElement('div');
            roomOutline.className = 'room-outline';
            roomOutline.style.width = `${roomWidth * scale}px`;
            roomOutline.style.height = `${roomLength * scale}px`;
            
            // Расчет количества секций по ширине и длине
            const sectionsWidth = Math.floor(roomWidth / section.width);
            const sectionsLength = Math.ceil(roomLength / section.length);
            
            // Создание визуализации секций
            for (let i = 0; i < sectionsWidth; i++) {
                for (let j = 0; j < sectionsLength; j++) {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'section';
                    sectionDiv.style.width = `${section.width * scale}px`;
                    sectionDiv.style.height = `${section.length * scale}px`;
                    sectionDiv.style.left = `${i * section.width * scale}px`;
                    sectionDiv.style.top = `${j * section.length * scale}px`;
                    
                    const label = document.createElement('div');
                    label.className = 'section-label';
                    label.textContent = section.name;
                    sectionDiv.appendChild(label);
                    
                    roomOutline.appendChild(sectionDiv);
                }
            }
            
            layoutDiv.appendChild(roomOutline);
            return layoutDiv;
        }

        // Обработчики событий
        document.getElementById('add-room').addEventListener('click', function() {
            const roomsContainer = document.getElementById('rooms-container');
            const newRoom = document.createElement('div');
            newRoom.className = 'room';
            newRoom.innerHTML = `
                <div class="form-group">
                    <label>Название помещения:</label>
                    <input type="text" class="room-name" placeholder="Например, Спальня">
                </div>
                <div class="form-group">
                    <label>Длина (м):</label>
                    <input type="number" class="room-length" min="0.1" step="0.1" value="4">
                </div>
                <div class="form-group">
                    <label>Ширина (м):</label>
                    <input type="number" class="room-width" min="0.1" step="0.1" value="3">
                </div>
                <button class="remove-room">Удалить</button>
            `;
            roomsContainer.appendChild(newRoom);
            
            // Добавляем обработчик удаления для новой комнаты
            newRoom.querySelector('.remove-room').addEventListener('click', function() {
                roomsContainer.removeChild(newRoom);
            });
        });

        // Добавляем обработчики удаления для существующих комнат
        document.querySelectorAll('.remove-room').forEach(button => {
            button.addEventListener('click', function() {
                const room = this.parentNode;
                document.getElementById('rooms-container').removeChild(room);
            });
        });

        document.getElementById('calculate').addEventListener('click', function() {
            const insulation = document.getElementById('insulation').value;
            const availableModels = filterModels(insulation);
            const rooms = document.querySelectorAll('.room');
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            if (rooms.length === 0) {
                resultsDiv.innerHTML = '<p>Добавьте хотя бы одно помещение</p>';
                return;
            }
            
            rooms.forEach(room => {
                const name = room.querySelector('.room-name').value || 'Неизвестное помещение';
                const length = parseFloat(room.querySelector('.room-length').value);
                const width = parseFloat(room.querySelector('.room-width').value);
                
                if (isNaN(length) || isNaN(width) || length <= 0 || width <= 0) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'result-item';
                    errorDiv.innerHTML = `<h3>${name}</h3><p>Ошибка: введите корректные размеры помещения</p>`;
                    resultsDiv.appendChild(errorDiv);
                    return;
                }
                
                const area = length * width;
                const optimalSection = calculateOptimalSection(length, width, availableModels);
                
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result-item';
                
                if (!optimalSection) {
                    resultDiv.innerHTML = `
                        <h3>${name}</h3>
                        <p>Длина: ${length} м, Ширина: ${width} м, Площадь: ${area.toFixed(2)} м²</p>
                        <p>Не удалось подобрать подходящую секцию для данного помещения</p>
                    `;
                } else {
                    const sectionsNeeded = Math.ceil(area / optimalSection.area);
                    const totalPower = sectionsNeeded * optimalSection.power;
                    
                    resultDiv.innerHTML = `
                        <h3>${name}</h3>
                        <p>Длина: ${length} м, Ширина: ${width} м, Площадь: ${area.toFixed(2)} м²</p>
                        <div class="section-info">
                            <h4>Используемая секция: ${optimalSection.name}</h4>
                            <table>
                                <tr>
                                    <th>Характеристика</th>
                                    <th>Значение</th>
                                </tr>
                                <tr>
                                    <td>Мощность секции</td>
                                    <td>${optimalSection.power} Вт</td>
                                </tr>
                                <tr>
                                    <td>Удельная мощность</td>
                                    <td>${optimalSection.powerM2} Вт/м²</td>
                                </tr>
                                <tr>
                                    <td>Площадь секции</td>
                                    <td>${optimalSection.area} м²</td>
                                </tr>
                                <tr>
                                    <td>Ширина секции</td>
                                    <td>${optimalSection.width} м</td>
                                </tr>
                                <tr>
                                    <td>Длина секции</td>
                                    <td>${optimalSection.length} м</td>
                                </tr>
                            </table>
                        </div>
                        <p><strong>Количество секций:</strong> ${sectionsNeeded} шт.</p>
                        <p><strong>Общая мощность:</strong> ${totalPower} Вт</p>
                    `;
                    
                    // Добавляем схему укладки
                    const layoutTitle = document.createElement('h4');
                    layoutTitle.textContent = 'Схема укладки:';
                    resultDiv.appendChild(layoutTitle);
                    
                    const layout = createLayout(length, width, optimalSection);
                    resultDiv.appendChild(layout);
                }
                
                resultsDiv.appendChild(resultDiv);
            });
        });
    </script>
</body>
</html>
