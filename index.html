<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор теплого пола</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .calculator-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .calculator-content {
            padding: 30px;
        }
        
        .step {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .step-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .option-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option-card:hover {
            border-color: #3498db;
        }
        
        .option-card.selected {
            border-color: #3498db;
            background-color: #ebf5fb;
        }
        
        .option-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .option-card p {
            color: #666;
            margin-bottom: 5px;
        }
        
        .option-card .power-info {
            font-size: 14px;
            color: #3498db;
            font-weight: bold;
        }
        
        .dimensions-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .dimension {
            display: flex;
            flex-direction: column;
        }
        
        .dimension label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }
        
        .dimension input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .area-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
        
        .area-info p {
            margin: 5px 0;
            font-weight: 500;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            margin: 20px 0;
        }
        
        .calculate-btn:hover {
            background: #2980b9;
        }
        
        .results-container {
            margin-top: 30px;
        }
        
        .result-card {
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            background-color: #f0fff4;
        }
        
        .result-card h4 {
            font-size: 22px;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .result-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .result-item strong {
            color: #555;
        }
        
        .warning {
            background: #fee;
            color: #c0392b;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #c0392b;
        }
        
        .power-warning {
            background: #fff3cd;
            color: #856404;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        
        .coverage-info {
            background: #e8f4f8;
            color: #2c3e50;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 14px;
            text-align: center;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .dimensions-input {
                grid-template-columns: 1fr;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .calculator-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <header>
            <h1>Калькулятор подбора теплого пола</h1>
            <p>Рассчитайте оптимальную модель для вашего помещения</p>
        </header>
        
        <div class="calculator-content">
            <div class="step">
                <div class="step-title">
                    <span class="step-number">1</span>
                    Оцените утепление помещения
                </div>
                <div class="options-grid" id="insulation-options">
                    <div class="option-card selected" data-value="low">
                        <h3>Низкое утепление</h3>
                        <p>Балкон, лоджия, старый дом</p>
                        <div class="power-info">Рекомендуемая мощность: от 200 Вт/м²</div>
                    </div>
                    <div class="option-card" data-value="medium">
                        <h3>Среднее утепление</h3>
                        <p>Городская квартира</p>
                        <div class="power-info">Рекомендуемая мощность: 180-200 Вт/м²</div>
                    </div>
                    <div class="option-card" data-value="high">
                        <h3>Высокое утепление</h3>
                        <p>Новостройка, утепленный дом</p>
                        <div class="power-info">Рекомендуемая мощность: 140-180 Вт/м²</div>
                    </div>
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">
                    <span class="step-number">2</span>
                    Размеры помещения
                </div>
                <div class="dimensions-input">
                    <div class="dimension">
                        <label for="room-length">Длина помещения (м)</label>
                        <input type="number" id="room-length" min="1" max="20" step="0.1" value="4.5">
                    </div>
                    <div class="dimension">
                        <label for="room-width">Ширина помещения (м)</label>
                        <input type="number" id="room-width" min="1" max="20" step="0.1" value="3.2">
                    </div>
                </div>
                <div class="area-info">
                    <p>Общая площадь: <span id="total-area">14.4</span> м²</p>
                    <p>Целевая площадь (90%): <span id="effective-area">12.96</span> м²</p>
                    <p style="font-size: 14px; color: #666;">Диапазон подбора: 85-100% от общей площади</p>
                </div>
            </div>
            
            <button class="calculate-btn" id="calculate-btn">Рассчитать оптимальную модель</button>
            
            <div class="results-container" id="results-container">
                <!-- Результаты появятся здесь -->
            </div>
        </div>
        
        <footer>
            <p>Расчет является предварительным. Для точного подбора обратитесь к специалисту.</p>
        </footer>
    </div>

    <script>
        // Данные моделей
        const models = [
            {name: 'ТКС-01', power: 230, powerM2: 460, area: 0.5, width: 1, length: 0.5},
            {name: 'ТКС-02', power: 180, powerM2: 360, area: 0.5, width: 1, length: 0.5},
            {name: 'ТКС-03', power: 180, powerM2: 250, area: 0.72, width: 1, length: 0.72},
            {name: 'ТКС-04', power: 160, powerM2: 213, area: 0.75, width: 1, length: 0.75},
            {name: 'ТКС-05', power: 140, powerM2: 165, area: 0.85, width: 1, length: 0.85},
            {name: 'ТКС-06', power: 140, powerM2: 140, area: 1, width: 1, length: 1},
            {name: 'ТКС-07', power: 100, powerM2: 71, area: 1.4, width: 1, length: 1.4},
            {name: 'ТКС-08', power: 180, powerM2: 257, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-09', power: 150, powerM2: 214, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-10', power: 150, powerM2: 185, area: 0.81, width: 0.7, length: 1.15},
            {name: 'ТКС-11', power: 145, powerM2: 188, area: 0.77, width: 0.7, length: 1.1},
            {name: 'ТКС-12', power: 140, powerM2: 200, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-13', power: 140, powerM2: 154, area: 0.91, width: 0.7, length: 1.3},
            {name: 'ТКС-14', power: 120, powerM2: 143, area: 0.84, width: 0.7, length: 1.2}
        ];

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Настройка выбора опций
            setupOptionSelection('insulation-options');
            
            // Обновление площади
            document.getElementById('room-length').addEventListener('input', updateArea);
            document.getElementById('room-width').addEventListener('input', updateArea);
            
            // Кнопка расчета
            document.getElementById('calculate-btn').addEventListener('click', calculate);
            
            // Первоначальный расчет
            updateArea();
        });

        // Настройка выбора опций
        function setupOptionSelection(containerId) {
            const options = document.querySelectorAll(`#${containerId} .option-card`);
            options.forEach(option => {
                option.addEventListener('click', function() {
                    options.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }

        // Обновление площади
        function updateArea() {
            const length = parseFloat(document.getElementById('room-length').value) || 0;
            const width = parseFloat(document.getElementById('room-width').value) || 0;
            const totalArea = length * width;
            const effectiveArea = totalArea * 0.9;
            
            document.getElementById('total-area').textContent = totalArea.toFixed(2);
            document.getElementById('effective-area').textContent = effectiveArea.toFixed(2);
        }

        // Получение выбранного значения
        function getSelectedValue(containerId) {
            const selected = document.querySelector(`#${containerId} .option-card.selected`);
            return selected ? selected.getAttribute('data-value') : null;
        }

        // Проверка укладки
        function checkFit(model, roomLength, roomWidth, sectionsNeeded) {
            const maxPower = 3360;
            const totalPower = sectionsNeeded * model.power;
            
            if (totalPower > maxPower) {
                return { fits: false, reason: `Превышена мощность (${totalPower} Вт > ${maxPower} Вт)` };
            }
            
            const minRoomDimension = Math.min(roomLength, roomWidth);
            if (model.width > minRoomDimension && model.length > minRoomDimension) {
                return { fits: false, reason: `Мат слишком большой для помещения` };
            }
            
            return { fits: true, totalPower };
        }

        // Основной расчет с расширенным диапазоном площадей
        function calculate() {
            const insulation = getSelectedValue('insulation-options');
            const roomLength = parseFloat(document.getElementById('room-length').value);
            const roomWidth = parseFloat(document.getElementById('room-width').value);
            const totalArea = roomLength * roomWidth;
            
            if (!roomLength || !roomWidth) {
                showError('Введите размеры помещения');
                return;
            }
            
            // Целевая площадь и диапазон подбора
            const targetArea = totalArea * 0.9; // 90% - идеал
            const minArea = totalArea * 0.85;   // 85% - минимум
            const maxArea = totalArea * 1.00;   // 100% - максимум
            
            // Фильтрация моделей по утеплению
            const suitableModels = models.filter(model => {
                if (insulation === 'low' && model.powerM2 >= 200) return true;
                if (insulation === 'medium' && model.powerM2 >= 180 && model.powerM2 <= 200) return true;
                if (insulation === 'high' && model.powerM2 >= 140 && model.powerM2 <= 180) return true;
                return false;
            }).sort((a, b) => b.powerM2 - a.powerM2);
            
            // Поиск оптимальной модели в диапазоне 85-100%
            let optimalModel = null;
            let optimalSections = 0;
            let coveragePercentage = 0;
            let closestToTarget = Infinity;
            
            for (const model of suitableModels) {
                // Рассчитываем возможное количество секций
                const minSections = Math.ceil(minArea / model.area);
                const maxSections = Math.floor(maxArea / model.area);
                
                // Перебираем возможное количество секций
                for (let sections = minSections; sections <= maxSections; sections++) {
                    const coverage = sections * model.area;
                    const fitCheck = checkFit(model, roomLength, roomWidth, sections);
                    
                    if (fitCheck.fits) {
                        const currentCoveragePercentage = (coverage / totalArea) * 100;
                        const deviationFromTarget = Math.abs(currentCoveragePercentage - 90);
                        
                        // Ищем модель с покрытием, наиболее близким к 90%
                        if (deviationFromTarget < closestToTarget) {
                            closestToTarget = deviationFromTarget;
                            optimalModel = model;
                            optimalSections = sections;
                            coveragePercentage = currentCoveragePercentage;
                        }
                    }
                }
            }
            
            if (optimalModel) {
                const coverage = optimalSections * optimalModel.area;
                const totalPower = optimalSections * optimalModel.power;
                
                displayResult({
                    model: optimalModel,
                    sectionsNeeded: optimalSections,
                    coverage: coverage,
                    totalPower: totalPower,
                    coveragePercentage: coveragePercentage
                }, roomLength, roomWidth, totalArea, insulation);
            } else {
                showError('Не найдено подходящей модели для выбранного уровня утепления. Попробуйте изменить критерии.');
            }
        }

        // Показать ошибку
        function showError(message) {
            const container = document.getElementById('results-container');
            container.innerHTML = `<div class="warning">${message}</div>`;
        }

        // Отображение результата
        function displayResult(result, roomLength, roomWidth, totalArea, insulation) {
            const container = document.getElementById('results-container');
            
            // Определяем текст для уровня утепления
            let insulationText = '';
            switch(insulation) {
                case 'low': insulationText = 'низкому утеплению'; break;
                case 'medium': insulationText = 'среднему утеплению'; break;
                case 'high': insulationText = 'высокому утеплению'; break;
            }
            
            const model = result.model;
            let coverageInfo = '';
            
            // Информация о покрытии
            if (result.coveragePercentage >= 89 && result.coveragePercentage <= 91) {
                coverageInfo = `<div class="coverage-info">Точное соответствие целевой площади (90%)</div>`;
            } else {
                coverageInfo = `<div class="coverage-info">Покрытие: ${result.coveragePercentage.toFixed(1)}% от общей площади (диапазон подбора: 85-100%)</div>`;
            }
            
            const html = `
                <div class="step-title">Рекомендация для помещения ${roomLength}м × ${roomWidth}м (${insulationText})</div>
                ${coverageInfo}
                <div class="result-card">
                    <h4>ОПТИМАЛЬНАЯ МОДЕЛЬ: ${model.name}</h4>
                    <div class="result-grid">
                        <div class="result-item"><strong>Мощность на м²:</strong> ${model.powerM2} Вт/м²</div>
                        <div class="result-item"><strong>Мощность секции:</strong> ${model.power} Вт</div>
                        <div class="result-item"><strong>Секций требуется:</strong> ${result.sectionsNeeded} шт.</div>
                        <div class="result-item"><strong>Покрываемая площадь:</strong> ${result.coverage.toFixed(2)} м²</div>
                        <div class="result-item"><strong>Общая мощность:</strong> ${result.totalPower} Вт</div>
                        <div class="result-item"><strong>Размер секции:</strong> ${model.width}м × ${model.length}м</div>
                    </div>
                    ${result.totalPower > 2500 ? 
                        `<div class="power-warning">Внимание: Мощность близка к предельной. Убедитесь в надежности электропроводки.</div>` : ''}
                </div>
            `;
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>
