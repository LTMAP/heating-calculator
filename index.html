<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор теплого пола - Многокомнатный расчет</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .calculator-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .calculator-content {
            padding: 30px;
        }
        
        .step {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .step-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .option-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option-card:hover {
            border-color: #3498db;
        }
        
        .option-card.selected {
            border-color: #3498db;
            background-color: #ebf5fb;
        }
        
        .option-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .option-card p {
            color: #666;
            margin-bottom: 5px;
        }
        
        .option-card .power-info {
            font-size: 14px;
            color: #3498db;
            font-weight: bold;
        }
        
        .room-container {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background: #f9f9f9;
        }
        
        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .room-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .remove-room {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .room-dimensions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .dimension {
            display: flex;
            flex-direction: column;
        }
        
        .dimension label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }
        
        .dimension input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .area-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .area-info p {
            margin: 3px 0;
            font-weight: 500;
        }
        
        .add-room-btn {
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            margin: 20px 0;
        }
        
        .calculate-btn:hover {
            background: #2980b9;
        }
        
        .results-container {
            margin-top: 30px;
        }
        
        .room-result {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .room-result-header {
            background: #34495e;
            color: white;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .room-result-content {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .result-card {
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 20px;
            background-color: #f0fff4;
        }
        
        .result-card h4 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .result-item {
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .result-item strong {
            color: #555;
        }
        
        .layout-visualization {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        
        .visualization-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .visualization-container {
            width: 100%;
            height: 300px;
            border: 1px solid #ddd;
            position: relative;
            background: #f9f9f9;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .room-outline {
            position: absolute;
            border: 2px solid #3498db;
            background: rgba(52, 152, 219, 0.1);
            box-sizing: border-box;
        }
        
        .section {
            position: absolute;
            border: 1px solid #e74c3c;
            background: rgba(231, 76, 60, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #c0392b;
            box-sizing: border-box;
        }
        
        .section.cut {
            background: rgba(231, 76, 60, 0.1);
            border-style: dashed;
        }
        
        .layout-info {
            background: #e8f4f8;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .summary-table {
            width: 100%;
            margin-top: 15px;
            margin-bottom: 10px;
            border-collapse: collapse;
        }
        
        .summary-table th, .summary-table td {
            border: 1px solid #e0e0e0;
            padding: 8px 10px;
            text-align: left;
        }
        
        .summary-table th {
            background: #ebf5fb;
        }
        
        .summary-table tfoot td {
            font-weight: bold;
            background: #f0fff4;
        }
        
        .warning {
            background: #fee;
            color: #c0392b;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #c0392b;
        }
        
        .power-warning {
            background: #fff3cd;
            color: #856404;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        
        .coverage-info {
            background: #e8f4f8;
            color: #2c3e50;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 14px;
            text-align: center;
        }
        
        .summary-result {
            background: #e0f9e8;
            border: 1px solid #27ae60;
            border-radius: 8px;
            margin-top: 15px;
            padding: 15px;
            font-size: 18px;
        }
        
        .total-summary {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .total-summary h3 {
            margin-bottom: 15px;
            text-align: center;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .room-dimensions {
                grid-template-columns: 1fr;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .calculator-content {
                padding: 15px;
            }
            
            .room-result-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <header>
            <h1>Калькулятор теплого пола - Многокомнатный расчет</h1>
            <p>Рассчитайте оптимальные модели для всех помещений вашего здания</p>
        </header>
        
        <div class="calculator-content">
            <div class="step">
                <div class="step-title">
                    <div style="display: flex; align-items: center;">
                        <span class="step-number">1</span>
                        Оцените утепление помещения
                    </div>
                </div>
                <div class="options-grid" id="insulation-options">
                    <div class="option-card selected" data-value="low">
                        <h3>Низкое утепление</h3>
                        <p>Балкон, лоджия, старый дом</p>
                        <div class="power-info">Рекомендуемая мощность: от 200 Вт/м²</div>
                    </div>
                    <div class="option-card" data-value="medium">
                        <h3>Среднее утепление</h3>
                        <p>Городская квартира</p>
                        <div class="power-info">Рекомендуемая мощность: 180-200 Вт/м²</div>
                    </div>
                    <div class="option-card" data-value="high">
                        <h3>Высокое утепление</h3>
                        <p>Новостройка, утепленный дом</p>
                        <div class="power-info">Рекомендуемая мощность: 140-180 Вт/м²</div>
                    </div>
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">
                    <div style="display: flex; align-items: center;">
                        <span class="step-number">2</span>
                        Добавьте помещения для расчета
                    </div>
                </div>
                
                <div id="rooms-container">
                    <!-- Помещения будут добавляться здесь -->
                </div>
                
                <button class="add-room-btn" id="add-room-btn">+ Добавить помещение</button>
            </div>
            
            <button class="calculate-btn" id="calculate-btn">Рассчитать для всех помещений</button>
            
            <div class="results-container" id="results-container">
                <!-- Результаты появятся здесь -->
            </div>
        </div>
        
        <footer>
            <p>Расчет является предварительным. Для точного подбора обратитесь к специалисту.</p>
        </footer>
    </div>

    <script>
        // Данные моделей
        const models = [
            {name: 'ТКС-01', power: 230, powerM2: 460, area: 0.5, width: 1, length: 0.5},
            {name: 'ТКС-02', power: 180, powerM2: 360, area: 0.5, width: 1, length: 0.5},
            {name: 'ТКС-03', power: 180, powerM2: 250, area: 0.72, width: 1, length: 0.72},
            {name: 'ТКС-04', power: 160, powerM2: 213, area: 0.75, width: 1, length: 0.75},
            {name: 'ТКС-05', power: 140, powerM2: 165, area: 0.85, width: 1, length: 0.85},
            {name: 'ТКС-06', power: 140, powerM2: 140, area: 1, width: 1, length: 1},
            {name: 'ТКС-07', power: 100, powerM2: 71, area: 1.4, width: 1, length: 1.4},
            {name: 'ТКС-08', power: 180, powerM2: 257, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-09', power: 150, powerM2: 214, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-10', power: 150, powerM2: 185, area: 0.81, width: 0.7, length: 1.15},
            {name: 'ТКС-11', power: 145, powerM2: 188, area: 0.77, width: 0.7, length: 1.1},
            {name: 'ТКС-12', power: 140, powerM2: 200, area: 0.7, width: 0.7, length: 1},
            {name: 'ТКС-13', power: 140, powerM2: 154, area: 0.91, width: 0.7, length: 1.3},
            {name: 'ТКС-14', power: 120, powerM2: 143, area: 0.84, width: 0.7, length: 1.2}
        ];

        let roomCounter = 0;
        let roomsData = [];

        document.addEventListener('DOMContentLoaded', function() {
            setupOptionSelection('insulation-options');
            document.getElementById('add-room-btn').addEventListener('click', addRoom);
            document.getElementById('calculate-btn').addEventListener('click', calculateAllRooms);
            addRoom();
        });

        function setupOptionSelection(containerId) {
            const options = document.querySelectorAll(`#${containerId} .option-card`);
            options.forEach(option => {
                option.addEventListener('click', function() {
                    options.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }

        function addRoom() {
            roomCounter++;
            const roomId = `room-${roomCounter}`;
            
            const roomHTML = `
                <div class="room-container" id="${roomId}">
                    <div class="room-header">
                        <div class="room-title">Помещение ${roomCounter}</div>
                        <button class="remove-room" onclick="removeRoom('${roomId}')">Удалить</button>
                    </div>
                    <div class="room-dimensions">
                        <div class="dimension">
                            <label for="${roomId}-name">Название помещения</label>
                            <input type="text" id="${roomId}-name" value="Комната ${roomCounter}" placeholder="Например: Гостиная">
                        </div>
                        <div class="dimension">
                            <label for="${roomId}-length">Длина (м)</label>
                            <input type="number" id="${roomId}-length" min="1" max="20" step="0.1" value="${4 + roomCounter * 0.5}">
                        </div>
                        <div class="dimension">
                            <label for="${roomId}-width">Ширина (м)</label>
                            <input type="number" id="${roomId}-width" min="1" max="20" step="0.1" value="${3 + roomCounter * 0.3}">
                        </div>
                    </div>
                    <div class="area-info">
                        <p>Общая площадь: <span id="${roomId}-total-area">0</span> м²</p>
                        <p>Целевая площадь (90%): <span id="${roomId}-effective-area">0</span> м²</p>
                    </div>
                </div>
            `;
            
            document.getElementById('rooms-container').insertAdjacentHTML('beforeend', roomHTML);
            updateRoomArea(roomId);
            document.getElementById(`${roomId}-length`).addEventListener('input', () => updateRoomArea(roomId));
            document.getElementById(`${roomId}-width`).addEventListener('input', () => updateRoomArea(roomId));
        }

        function removeRoom(roomId) {
            if (document.querySelectorAll('.room-container').length <= 1) {
                alert('Должно остаться хотя бы одно помещение');
                return;
            }
            document.getElementById(roomId).remove();
            renumberRooms();
        }

        function renumberRooms() {
            const rooms = document.querySelectorAll('.room-container');
            roomCounter = 0;
            rooms.forEach((room, index) => {
                roomCounter++;
                const roomId = `room-${roomCounter}`;
                room.id = roomId;
                const header = room.querySelector('.room-title');
                header.textContent = `Помещение ${roomCounter}`;
                const nameInput = room.querySelector('input[type="text"]');
                if (nameInput.value === `Комната ${index + 1}`) {
                    nameInput.value = `Комната ${roomCounter}`;
                }
                const removeBtn = room.querySelector('.remove-room');
                removeBtn.setAttribute('onclick', `removeRoom('${roomId}')`);
                const inputs = room.querySelectorAll('input');
                inputs.forEach(input => {
                    const oldId = input.id;
                    const newId = oldId.replace(/room-\d+/, roomId);
                    input.id = newId;
                });
                const spans = room.querySelectorAll('span');
                spans.forEach(span => {
                    const oldId = span.id;
                    if (oldId) {
                        const newId = oldId.replace(/room-\d+/, roomId);
                        span.id = newId;
                    }
                });
            });
        }

        function updateRoomArea(roomId) {
            const length = parseFloat(document.getElementById(`${roomId}-length`).value) || 0;
            const width = parseFloat(document.getElementById(`${roomId}-width`).value) || 0;
            const totalArea = length * width;
            const effectiveArea = totalArea * 0.9;
            document.getElementById(`${roomId}-total-area`).textContent = totalArea.toFixed(2);
            document.getElementById(`${roomId}-effective-area`).textContent = effectiveArea.toFixed(2);
        }

        function getSelectedInsulation() {
            const selected = document.querySelector('#insulation-options .option-card.selected');
            return selected ? selected.getAttribute('data-value') : null;
        }

        function checkFit(model, roomLength, roomWidth, sectionsNeeded) {
            const maxPower = 3360;
            const totalPower = sectionsNeeded * model.power;
            if (totalPower > maxPower) {
                return { fits: false, reason: `Превышена мощность (${totalPower} Вт > ${maxPower} Вт)` };
            }
            const minRoomDimension = Math.min(roomLength, roomWidth);
            if (model.width > minRoomDimension && model.length > minRoomDimension) {
                return { fits: false, reason: `Мат слишком большой для помещения` };
            }
            return { fits: true, totalPower };
        }

        function calculateRoom(roomId, roomName, length, width, insulation) {
            const totalArea = length * width;
            const targetArea = totalArea * 0.9;
            const minArea = totalArea * 0.85;
            const maxArea = totalArea * 1.00;
            const suitableModels = models.filter(model => {
                if (insulation === 'low' && model.powerM2 >= 200) return true;
                if (insulation === 'medium' && model.powerM2 >= 180 && model.powerM2 <= 200) return true;
                if (insulation === 'high' && model.powerM2 >= 140 && model.powerM2 <= 180) return true;
                return false;
            }).sort((a, b) => b.powerM2 - a.powerM2);
            let optimalModel = null;
            let optimalSections = 0;
            let coveragePercentage = 0;
            let closestToTarget = Infinity;
            for (const model of suitableModels) {
                const minSections = Math.ceil(minArea / model.area);
                const maxSections = Math.floor(maxArea / model.area);
                for (let sections = minSections; sections <= maxSections; sections++) {
                    const coverage = sections * model.area;
                    const fitCheck = checkFit(model, length, width, sections);
                    if (fitCheck.fits) {
                        const currentCoveragePercentage = (coverage / totalArea) * 100;
                        const deviationFromTarget = Math.abs(currentCoveragePercentage - 90);
                        if (deviationFromTarget < closestToTarget) {
                            closestToTarget = deviationFromTarget;
                            optimalModel = model;
                            optimalSections = sections;
                            coveragePercentage = currentCoveragePercentage;
                        }
                    }
                }
            }
            if (optimalModel) {
                const coverage = optimalSections * optimalModel.area;
                const totalPower = optimalSections * optimalModel.power;
                const thermostatCount = Math.max(1, Math.ceil(coverage / 20));
                const thermostatPrice = 5000;
                const thermostatTotal = thermostatPrice * thermostatCount;
                const installPrice = coverage * 1000 + thermostatCount * 3000;
                const floorPrice = coverage * 3000;
                const totalCost = installPrice + floorPrice + thermostatTotal;
                const powerUsage = totalArea * 20;
                return {
                    roomId,
                    roomName,
                    length,
                    width,
                    totalArea,
                    model: optimalModel,
                    sectionsNeeded: optimalSections,
                    coverage,
                    totalPower,
                    coveragePercentage,
                    powerUsage,
                    thermostatCount,
                    thermostatPrice,
                    thermostatTotal,
                    installPrice,
                    floorPrice,
                    totalCost,
                    success: true
                };
            }
            return {
                roomId,
                roomName,
                length,
                width,
                totalArea,
                success: false
            };
        }

        // Упрощенная визуализация как для плитки/ламината
        function visualizeLayout(roomResult, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const roomLength = roomResult.length;
            const roomWidth = roomResult.width;
            const model = roomResult.model;
            const totalSections = roomResult.sectionsNeeded;
            
            // Масштабирование
            const maxWidth = 400;
            const maxHeight = 280;
            const scaleX = maxWidth / roomLength;
            const scaleY = maxHeight / roomWidth;
            const scale = Math.min(scaleX, scaleY);
            
            // Контур помещения
            const roomElement = document.createElement('div');
            roomElement.className = 'room-outline';
            roomElement.style.width = `${roomLength * scale}px`;
            roomElement.style.height = `${roomWidth * scale}px`;
            roomElement.style.left = '50%';
            roomElement.style.top = '50%';
            roomElement.style.transform = 'translate(-50%, -50%)';
            container.appendChild(roomElement);
            
            // Простой расчет укладки как плитки
            const sectionsInRow = Math.floor(roomLength / model.length);
            const rows = Math.ceil(totalSections / sectionsInRow);
            
            let sectionCount = 0;
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < sectionsInRow; col++) {
                    if (sectionCount >= totalSections) break;
                    
                    const sectionElement = document.createElement('div');
                    sectionElement.className = 'section';
                    sectionElement.style.width = `${model.length * scale}px`;
                    sectionElement.style.height = `${model.width * scale}px`;
                    sectionElement.style.left = `${col * model.length * scale}px`;
                    sectionElement.style.top = `${row * model.width * scale}px`;
                    sectionElement.title = `${model.name} (${model.width}м × ${model.length}м)`;
                    
                    // Номер секции
                    const sectionNumber = document.createElement('div');
                    sectionNumber.textContent = sectionCount + 1;
                    sectionElement.appendChild(sectionNumber);
                    
                    roomElement.appendChild(sectionElement);
                    sectionCount++;
                }
                if (sectionCount >= totalSections) break;
            }
            
            // Информация о схеме укладки
            const layoutInfo = document.createElement('div');
            layoutInfo.className = 'layout-info';
            layoutInfo.innerHTML = `
                <strong>Схема укладки:</strong> ${sectionsInRow} × ${rows} (${sectionsInRow} секций в ряду, ${rows} рядов)<br>
                <strong>Ориентация:</strong> длина секции (${model.length}м) вдоль длины помещения
            `;
            container.appendChild(layoutInfo);
        }

        function calculateAllRooms() {
            const insulation = getSelectedInsulation();
            const rooms = document.querySelectorAll('.room-container');
            roomsData = [];
            if (rooms.length === 0) {
                showError('Добавьте хотя бы одно помещение');
                return;
            }
            rooms.forEach(room => {
                const roomId = room.id;
                const roomName = document.getElementById(`${roomId}-name`).value || `Помещение ${roomId}`;
                const length = parseFloat(document.getElementById(`${roomId}-length`).value);
                const width = parseFloat(document.getElementById(`${roomId}-width`).value);
                if (!length || !width) {
                    showError(`Заполните размеры для ${roomName}`);
                    return;
                }
                const roomResult = calculateRoom(roomId, roomName, length, width, insulation);
                roomsData.push(roomResult);
            });
            displayAllResults(roomsData);
        }

        function displayAllResults(roomsData) {
            const container = document.getElementById('results-container');
            let html = '';
            let totalArea = 0;
            let totalCoverage = 0;
            let totalPower = 0;
            let totalCost = 0;
            let totalThermostats = 0;
            roomsData.forEach(room => {
                if (room.success) {
                    totalArea += room.totalArea;
                    totalCoverage += room.coverage;
                    totalPower += room.totalPower;
                    totalCost += room.totalCost;
                    totalThermostats += room.thermostatCount;
                }
            });
            roomsData.forEach((room, index) => {
                if (!room.success) {
                    html += `
                        <div class="room-result">
                            <div class="room-result-header">${room.roomName} - Не найдено подходящей модели</div>
                            <div class="warning" style="margin: 15px;">
                                Для помещения ${room.length}м × ${room.width}м не найдено подходящей модели. Попробуйте изменить размеры или параметры утепления.
                            </div>
                        </div>
                    `;
                    return;
                }
                const visualizationId = `visualization-${index}`;
                html += `
                    <div class="room-result">
                        <div class="room-result-header">${room.roomName} (${room.length}м × ${room.width}м)</div>
                        <div class="room-result-content">
                            <div class="result-card">
                                <h4>ОПТИМАЛЬНАЯ МОДЕЛЬ: ${room.model.name}</h4>
                                <div class="result-grid">
                                    <div class="result-item"><strong>Мощность на м²:</strong> ${room.model.powerM2} Вт/м²</div>
                                    <div class="result-item"><strong>Мощность секции:</strong> ${room.model.power} Вт</div>
                                    <div class="result-item"><strong>Секций требуется:</strong> ${room.sectionsNeeded} шт.</div>
                                    <div class="result-item"><strong>Покрываемая площадь:</strong> ${room.coverage.toFixed(2)} м²</div>
                                    <div class="result-item"><strong>Общая мощность:</strong> ${room.totalPower} Вт</div>
                                    <div class="result-item"><strong>Размер секции:</strong> ${room.model.width}м × ${room.model.length}м</div>
                                </div>
                                ${room.totalPower > 2500 ? 
                                    `<div class="power-warning">Внимание: Мощность близка к предельной. Убедитесь в надежности электропроводки и согласуйте проект с электриком.</div>` : ''
                                }
                            </div>
                            <div class="layout-visualization">
                                <div class="visualization-title">Схема укладки</div>
                                <div class="visualization-container" id="${visualizationId}"></div>
                                <div class="coverage-info">
                                    Покрытие: ${room.coveragePercentage.toFixed(1)}% от общей площади помещения
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            if (roomsData.some(room => room.success)) {
                html += `
                    <div class="total-summary">
                        <h3>ОБЩИЙ ИТОГ ПО ВСЕМУ ЗДАНИЮ</h3>
                        <table class="summary-table">
                            <tr><th>Общая площадь помещений</th><td>${totalArea.toFixed(2)} м²</td></tr>
                            <tr><th>Общая площадь укладки</th><td>${totalCoverage.toFixed(2)} м²</td></tr>
                            <tr><th>Общая мощность системы</th><td>${totalPower} Вт</td></tr>
                            <tr><th>Количество терморегуляторов</th><td>${totalThermostats} шт.</td></tr>
                            <tr><th>Общая стоимость</th><td>${totalCost.toLocaleString('ru-RU')} руб.</td></tr>
                        </table>
                    </div>
                `;
            }
            container.innerHTML = html;
            roomsData.forEach((room, index) => {
                if (room.success) {
                    setTimeout(() => {
                        visualizeLayout(room, `visualization-${index}`);
                    }, 100);
                }
            });
        }

        function showError(message) {
            const container = document.getElementById('results-container');
            container.innerHTML = `<div class="warning">${message}</div>`;
        }
    </script>
</body>
</html>